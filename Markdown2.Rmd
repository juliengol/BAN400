---
title: "Markdown2"
author: "BAN400"
date: "23 11 2020"
output: 
 html_document:
    theme: paper
    toc: true
    toc_float: true
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


![](https://upload.wikimedia.org/wikipedia/commons/5/5c/Olympic_rings_without_rims.svg){width=800px}


[Olympic Rings](https://upload.wikimedia.org/wikipedia/commons/5/5c/Olympic_rings_without_rims.svg)

## Introduction

This report aim to illustrate Olympic Medalist winners throughout the years. 
This is done by creating different tables, plots and a bar animation.

The rekkef√∏lge of the report is as follows

1. Table for total amount of medals won
2. Plot showing amount of events split into winter and summer olympics
3. Table illustrating the most-winning countries
4. Word clouds representing the frequenzy of medals for all medals combined and for each type of medal separately
5. Plot showing amount of gold medals won per sport
6. Table for most-winning country in a single sport
7. Table illustrating the highest participation in a singe sport
8. Deep dive into the US: medals won over time
9. Table for top ten winning contestants
10. Plot showing the genders' participation over time
11. Bar animation for gold medals over the years


*NB*

|

The used data sets are downloaded from [Kaggle](https://www.kaggle.com/the-guardian/olympic-games) and contains medal winners from 1896 - 2014. We were unable to find datasets including the most recent olympics, thus the summer olympics from 2016 is not included.




```{r load-packages, include=FALSE}
library(tidyverse)
library(lubridate)
library(magrittr)
library(sp)
library(ggplot2)
library(rgdal)
library(sf)
library(lwgeom)
library(gganimate)
library(stringr)
library(wordcloud)
library(tm)
library(SnowballC)
library(RColorBrewer)
library(dplyr)
library(knitr)
library(kableExtra)

```

```{r sort data, include=FALSE}
# Loading data sets 
winter<-read_csv("winter.csv") %>%              # Winter olympics
  rename(code   = "Country") %>%                # renaming the column "Country" to code, to merge with "info"
  mutate(season = "winter")

summer<-read_csv("summer.csv") %>%              # Summer olympics
  rename(code   = "Country") %>%                # renaming the column "Country" to code, to merge with "info"
  mutate(season = "summer")


info<- read_csv("dictionary.csv") %>%           # General information about countries. 
  na.omit() %>%                                 # using the column "code" to be
  rename(code = "Code")                         # able to merge the data frames.


# we want one data frame containing both summer and winter olympics:
df.ol<- winter %>% 
  bind_rows(summer) %>% 
  inner_join(., info, by = "code") 

# Using bind_rows to combine the df summer and winter, 
# and inner_join to bind them by the column containing country code  


colnames(df.ol) <- tolower(colnames(df.ol))
```

|
|
|
|


## 1. Total Amount of Medals won

```{r medalss, echo=FALSE, warning=FALSE,message=FALSE}

df.ol %>% 
  count(medal) %>% 
  kbl(caption = "Total Number of Medals", col.names = c("Medal", "Number")) %>% 
  kable_styling(bootstrap_options = "striped", full_width = F, position = "left")

```

|
|
|
|

## 2. Amount of Events 

```{r events, echo=FALSE, warning=FALSE, message=FALSE}

df.ol%>%
  group_by(season, year) %>%
  summarise(Events = n_distinct(event)) %>%
  ggplot(mapping = aes(x = year, y = Events, color = season)) + 
  theme_bw() +
  geom_point() +                             # using both points and lines
  geom_line() 

```

|
|
|
|


## 3. Most-Winning Countries

```{r medals, echo=FALSE, warning=FALSE, message=FALSE}

# function for data frame separating winners by type and country

medals<- function(data, by_year = FALSE) {
  
  
  # preparing the data
  ol <- data %>%                               
    mutate(Gold   = medal == "Gold",           # splitting the medal column
           Silver = medal == "Silver",         # into separate columns for 
           Bronze = medal == "Bronze")         # gold, silver and bronze medals
  
  
  # Then filter                                
  if(isTRUE(by_year)) {                       
    ol<- ol %>%                                # grouping by year and country if  
      group_by(year, country)                    # TRUE is set in the argument,
  } else {                                     # group only by country if not
    ol<- ol %>% 
      group_by(country)
  }
  
  # dividing by medal type
  ol <- ol %>% 
    dplyr::summarise(                         
      Nr_Medals   = sum(!is.na(medal)),       # counting total amount of medals
      Gold        = sum(Gold,   na.rm = T),   # sorting by country and number of 
      Silver      = sum(Silver, na.rm = T),   # each type of medals, counting 
      Bronze      = sum(Bronze, na.rm = T),   # winning contestants.
      contestants = n()) %>%                  
    arrange(-Nr_Medals)                       # most winning countries at the top 
}                                             # !is.na --> sum all values that is
# not equal to na.


# Then, using the function to create df                  
only.medals<-medals(df.ol, by_year = FALSE)   # sorting only by country

kbl(head(only.medals),
    col.names = c('Country', 'Total number of medals', 'Gold', 'Silver', 'Bronze', 'Contestants'),
    align = "lccccc",
    title = "Most Winning Nations") %>% 
  kable_material(c("striped", "hover"))

```

|
|
|
|

## 4. Word Clouds {.tabset}

```{r word cloud code, echo=FALSE, warning=FALSE,message=FALSE}


df.medals <- df.ol %>% 
  mutate(Gold   = medal == "Gold",           # splitting the medal column
          Silver = medal == "Silver",         # into separate columns for 
          Bronze = medal == "Bronze") %>% 
  group_by(country) %>% 
  summarise(                         
    All         = sum(!is.na(medal)),       # counting total amount of medals
    Gold        = sum(Gold,   na.rm = T),   # sorting by country and number of 
    Silver      = sum(Silver, na.rm = T),   # each type of medals, counting 
    Bronze      = sum(Bronze, na.rm = T))
```

### Combined
This plot illustrates all medals combined

```{r Combined, echo=FALSE, warning=FALSE,message=FALSE}

wordcloud(words = df.medals$country,
          freq = df.medals$All,
          colors = brewer.pal(8, "Dark2"),
          random.order = FALSE)
```

From the word cloud, we see that the US is the most winning nation, and that their lead in number of medals won is substantial.

|
|
|
|

### Gold
This plot illustrates gold medals
```{r Gold, echo=FALSE, warning=FALSE,message=FALSE}

wordcloud(words = df.medals$country,
          freq = df.medals$Gold,
          colors = brewer.pal(8, "Dark2"),
          random.order = FALSE)
```

The US has a substantial larger number of gold medals compared to the rest of the countries.

|
|
|
|

### Silver
This plot illustrates silver medals
```{r Silver, echo=FALSE, warning=FALSE,message=FALSE}

wordcloud(words = df.medals$country,
          freq = df.medals$Silver,
          colors = brewer.pal(8, "Dark2"),
          random.order = FALSE)
```

|
|
|
|

### Bronze
This plot illustrates bronze medals
```{r Bronze, echo=FALSE, warning=FALSE,message=FALSE}

wordcloud(words = df.medals$country,
          freq = df.medals$Bronze,
          colors = brewer.pal(8, "Dark2"),
          random.order = FALSE)
```

Compared to gold and silver medals, the distribution of bronze medals is more even among the different countries. 

|
|
|
|

## 5. Gold Medals per sport

```{r events1, echo=FALSE, warning=FALSE, message=FALSE}


df.ol[, c(1,3)] %>% 
  ggplot(aes(fct_infreq(sport), fill=sport)) + 
  geom_bar() + 
  xlab("sports") + 
  ylab("total  Gold medal number") +
  coord_flip()
  
```


|
|
|
|

## 6. Most Winning Country in a Single Sport

```{r most winning country, echo=FALSE, warning=FALSE, message=FALSE}
df.ol %>%
  count(event, country) %>%
  group_by(event) %>%
  mutate(totals = sum(n),                       # Finding the number of medals 
         percent_Medals = n/sum(n)) %>%         # per country sorted by events
  arrange(desc(percent_Medals)) %>%             # counting the total number of
  filter(n> 200) %>%                            # medals and calculating the percentage)
  kbl(caption = "Most Winning Country in a Single Sport",
      col.names = c('Event', 'Country', 'Medals won', 'Total number of medals', '%'),
      align = "llccc",
      digits = 3) %>% 
  kable_material(c("striped", "hover"))

```
_The table shows which country which has won the most country in a single sport **percentage wise** compared to the total amount of medals given._

The table shows that the US has won the most medals in a single sport, which is Basketball. In this sport, they account for 42,6% of the medals. 

|
|
|
|

## 7. Highest Participation in a Single Sport 

```{r participation, echo=FALSE, warning=FALSE, message=FALSE}

df.ol %>%
  group_by(country, sport) %>%
  summarise(events = n_distinct(event)) %>%      # counting the number of events
  arrange(desc(events)) %>%                      # arranging in descending order
  head() %>% 
  kbl(caption = "Table: Which country participates most in a single sport?",
  col.names = c('Country', 'Sport', 'Number of Events'),
  align = "llc") %>% 
  kable_material(c("striped", "hover"))

```
(_Score given in absolute numbers_)

The US participates the most in a single sport, which is Wrestling. 

Not surprisingly, Norway is the country with the highest participation in skiing 

|
|
|
|

## 8. Deep Dive into the US:
Since the US has won the most medals both overall and in a single sport (percentage wise), and is also the country with the highest participation in a single sport, a deep dive is interesting. 

```{r, plot over US, echo=FALSE, warning=FALSE, message=FALSE}
df.us <- df.ol %>% 
  filter(country == "United States") %>% 
  select(c(medal, year, season)) %>%
  group_by(year, medal) %>% 
  summarise(n_medal = n()) %>%                      
  complete(medal,year)


# finding the year with the most medals won to set a limit on the y axis.
most_medals <- max(df.us$n_medal, na.rm = TRUE)


# plotting the animation
df.us %>% 
  ggplot(aes(year,n_medal,color=medal,group=medal)) + 
  geom_line() +
  scale_y_continuous(limits = c(0, most_medals)) +
  theme_minimal() +
  ylab("Number of Medals") + 
  xlab("Year") + 
  ggtitle("OL Medals", subtitle = "United States, US") + 
  transition_reveal(year)

```

The plot showcases the development of number of medals for the US.
There is a somewhat similar pattern for the different types of medals.
Gold medals (green line) most often represent the most attained medal type through time. 

The plot also illustrate:

* Peak in 1905
* Rise in number of gold medals from 1980

|
|
|
|

## 9. Most Winning Contestant 

```{r contestant, echo=FALSE,  warning=FALSE, message=FALSE}
indiv_medals <- df.ol %>%                   # creating a data frame for medals
  group_by(athlete,sport) %>%               # per contestants, and another where
  summarise(medals = n())                   # medals is sorted by descending order

indiv_medals <- data.frame(indiv_medals)
sort_indiv_medals <- indiv_medals[order(-indiv_medals$medals),]

rownames(sort_indiv_medals) <- c()

kbl(head(sort_indiv_medals,10), title = "Most Winning Contestants",
      align = "llcc") %>% 
  kable_material(c("striped", "hover"))

```

The table shows that Michael Phelps is the most winning athlete, with 22 medals. 
Both Ole Einar Bj√∏rndalen and Bj√∏rn D√¶hlie are among the top winners, with respectively 13 and 12 medals each. 

_(Anno 2020 Pelphs has a total of 28 olympic medals, still reigning as most winning athlete)_

![](https://upload.wikimedia.org/wikipedia/commons/2/27/Michael_Phelps_conquista_20%C2%AA_medalha_de_ouro_e_%C3%A9_ovacionado_1036424-09082016-_mg_7146.jpg)

[Michael Phelps](https://upload.wikimedia.org/wikipedia/commons/2/27/Michael_Phelps_conquista_20%C2%AA_medalha_de_ouro_e_%C3%A9_ovacionado_1036424-09082016-_mg_7146.jpg)

|
|
|
|

## 10. Participation Development by Gender

Like other parts of society, the olympic games excluded female participation for quite some time. The following plot will demonstrate the gender's participation development through time. 

|

```{r gender, echo=FALSE, fig.width = 8, fig.height= 6}
# Olympic medals by gender for winter and summer combined
df.ol %>% 
  count(year, gender) %>%
  group_by(year) %>%
  mutate(Percent = n/sum(n)*100) %>%                 # sorting by percentage
  arrange(desc(Percent)) %>%
  ggplot(mapping = aes(x = year, y = Percent, color = gender)) + 
  geom_point() + 
  theme_minimal() +
  scale_x_continuous(minor_breaks = seq(min(df.ol$year) , max(df.ol$year), 4), 
                     breaks = seq(min(df.ol$year), max(df.ol$year), 4)) +
  labs(title = 'Olympic Medals by Gender', color = 'Legend', 
       subtitle = 'Percentage of Medals Won by Each Gender') + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

From 1900, female participation started rising. However, it would take almost 96 years before the participation of the genders would represent about 50% of the events each. 

|
|
|
|

## 11. Bar Animation for Gold Medals over the Years

Top 10 countries

```{r bar animation, echo=FALSE,  warning=FALSE, message=FALSE}

year.medals<-medals(df.ol, by_year = TRUE)    # sorting by year and country
# first, creating and sorting a df for medals
medal <- year.medals %>%                     # choose to count gold medals and
  select(year, country, Gold) %>%            # sort by countries over time
  group_by(country) %>%                      
  arrange(year) %>%                         
  mutate(value = cumsum(Gold)) %>%           
  ungroup()    


medals_formatted <- medal %>%
  group_by(year) %>%
  mutate(rank = rank(-value)) %>%            # Descending value
  group_by(country) %>% 
  filter(rank <=10) %>%                      # only choosing top 10 countries
  ungroup()


# Animation of the medal gold count   

# // souce: Amrrs (2020, 16. March) animated_bar_charts_in_R. Retreived from: https://github.com/amrrs/animated_bar_charts_in_R/blob/master/animated_bar_plot_in_R.R

anim <- ggplot(medals_formatted, aes(rank, 
                                     group = country, 
                                     fill  = as.factor(country), 
                                     color = as.factor(country))) +
  geom_tile(aes(y      = value/2,
                height = value,
                width  = 0.9), 
                alpha  = 0.8, 
                color  = NA) +
  geom_text(aes(y = 0,    label = paste(country, " ")), vjust = 0.2, hjust = 1) +
  geom_text(aes(y = value,label = scales::number(value, acc = 1), hjust = 0)) +
  coord_flip(clip = "off", expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +
  theme(axis.line=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks=element_blank(),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        legend.position="none",
        panel.background=element_blank(),
        panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.major.x = element_line( size=.1, color="grey" ),
        panel.grid.minor.x = element_line( size=.1, color="grey" ),
        plot.title=element_text(size=25, hjust=0.5, face="bold", colour="grey", vjust=-1),
        plot.subtitle=element_text(size=18, hjust=0.5, face="italic", color="grey"),
        plot.caption =element_text(size=8, hjust=0.5, face="italic", color="grey"),
        plot.background=element_blank(),
        plot.margin = margin(2,2, 2, 4, "cm")) +
  transition_states(year, transition_length = 4, state_length = 1, wrap = FALSE) +
  view_follow(fixed_x = TRUE)  +
  labs(title    = 'Gold medals per year : {closest_state}',  
       subtitle = "Top 10 Countries",
       caption  = "Olympics medals") 

anim

```

## The End